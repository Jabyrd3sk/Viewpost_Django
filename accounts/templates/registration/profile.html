{% extends 'viewpost/base.html' %}
{% load django_bootstrap5 %}
{% load humanize %}
{% block title %} {{ profile.user.username }}'s Profile{% endblock %}

{% block content %}
  <div align="center">
    {% if profile.photo %}
      <img src="{{ profile.photo.url }}" style="width:150px; height:150px; border-radius:50%; object-fit:cover;">
      <h2 style="color:black;">@{{ profile.user.username }}</h2>
    {% else %}
      <div style="width:150px; height:150px; border-radius:50%; background:#ccc;"></div>
    {% endif %}

    <p>
      Posts: {{ posts_count }} | 
      <a href="{% url 'accounts:followers_list' profile.user.username %}">Followers: {{ followers_count }}</a> |
      <a href="{% url 'accounts:following_list' profile.user.username %}">Following: {{ following_count }}</a>
    </p>

    {% if request.user.is_authenticated and request.user != profile.user %}
     <form method="post" action="{% url 'accounts:toggle_follow' profile.user.username %}">
        {% csrf_token %}
        {% if profile in request.user.profile.following.all %}
          <button class="btn btn-light">Unfollow</button>
        {% else %}
          <button class="btn btn-danger">Follow</button>
        {% endif %}
     </form>
   {% endif %}

    {% if profile.bio %}
      <p>{{ profile.bio|linebreaks }}</p>
    {% else %}
      <p><em>No bio yet.</em></p>
    {% endif %}
    
      
    {% if request.user == profile.user %}
        <p><a href="{% url 'accounts:edit_profile' %}">Edit profile</a></p>
    {% endif %}

  </div>   
   <hr>
{% block page_header %}
  {% if request.user == profile.user %}
    <h3>My Posts</h3>
  {% else %}
   <h3>Posts by {{ profile.user.username }}</h3>
  {% endif %}
{% endblock %}
   {% for post in posts %}
  <div id="post-{{ post.id }}" class="card mb-3">
    <div class="card-body">

      {% if post.image %}
        <img src="{{ post.image.url }}" class="mb-1 w-25 img-fluid rounded mb-2">
      {% endif %}
      <p>{{ post.content }}</p>
           
      <!-- Likes & comments-->
      <p>
        <form action="{% url 'viewpost:like_post' post.id %}" method="post" style="display:inline; vertical-align: middle;">
          {% csrf_token %}
          <button type="submit" style="border:none; background:none; cursor: pointer; vertical-align: middle;">
            {% if user in post.likes.all %}
              ‚ù§Ô∏è
            {% else %}
              ü§ç
            {% endif %}
          </button>
        </form>
        <span style="vertical-align: middle;">{{ post.likes.count }} likes |</span>
        <a href="{% url 'viewpost:comment_page' post.id %}" 
          style="vertical-align: middle; text-decoration: none; color:inherit">
          {{ post.comments.count }} comments</a>
      </p>
      <p class="small text-muted">Posted {{ post.created_at|naturaltime }}</p>
          
          {% if request.user == profile.user %}
              <a href="{% url 'viewpost:delete_post' post.id %}" class="btn btn-sm btn-secondary">Delete post</a>
          </div>
          
          {% endif %}
        </div>
      </div>
    {% empty %}
      <p>No posts yet.</p>
    {% endfor %}
{% endblock %}